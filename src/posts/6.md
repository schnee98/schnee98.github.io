---
title: "í¬ë¡¬ì˜ ìµœëŒ€ ìŠ¤í¬ë¦°ìƒ· í¬ê¸° ì•Œì•„ë³´ê¸°"
date: "2025-02-06"
description: "ìŠ¤í¬ë¦°ìƒ·ì´ ì§¤ë ¤ìš”!! (ì‹¤ì œ ì œë³´)"
thumbnail: "img/posts/6/answer.png"
---

### ì£¼ì˜ì‚¬í•­

- **ì´ë²ˆ í¬ìŠ¤íŠ¸ëŠ” ê°œì¸ì ì¸ íšŒê³ ê¸€ë¡œ ë°˜ë§ë¡œ ê¸€ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.**
- **2024ë…„ 11ì›” 27ì¼ì— ì ì€ ê°œì¸ ë©”ëª¨ë¥¼ ì˜®ê¸´ ê¸€ì…ë‹ˆë‹¤.**
- **ê°œì¸ ë©”ëª¨ë¼ì„œ ë‚´ìš© ì •ë¦¬ê°€ ì›í™œí•˜ê²Œ ë˜ì§€ ì•Šì€ ì  ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ğŸ™‡â€â™‚ï¸**

## ë¬¸ì œ

íšŒì‚¬ì—ì„œ **ì „ì²´ í˜ì´ì§€ë¥¼ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì¶”ì¶œ**í•´ì•¼ í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìƒê²¼ë‹¤.

ì „ì²´ í˜ì´ì§€ì˜ ê²½ìš° ìŠ¤í¬ë¦°ìƒ·ì˜ í¬ê¸°ê°€ ë§¤ìš° ë§¤ìš° ì»¤ì§ˆ ìˆ˜ê°€ ìˆë‹¤. (+ ì˜ˆì‹œ ìŠ¤í¬ë¦°ìƒ·, ë³´ì•ˆì„ ìœ„í•´ ëª¨ìì´í¬ í˜¹ì€ ë¸”ëŸ¬ ì¡°ê¸ˆ)

ìŠ¤í¬ë¦°ìƒ·ì´ ì»¤ì§ˆ ë•Œ ìŠ¤í¬ë¦°ìƒ·ì„ í•´ë³´ë‹ˆ, **ìŠ¤í¬ë¦°ìƒ·ì´ ì§¤ë¦¬ëŠ” ë¬¸ì œ**ê°€ ìƒê²¼ë‹¤.

## ì›ì¸

í¬ë¡¬ (í¬ë¡œë¯¸ì›€) ë¸Œë¼ìš°ì €ëŠ” **í…ìŠ¤ì³ ì‚¬ì´ì¦ˆê°€ ìµœëŒ€ 16,384px** ê¹Œì§€ ë°–ì— ì§€ì›í•˜ì§€ ëª»í•œë‹¤..

## ì •ë§ ê·¸ëŸ°ì§€ ë³¼ê¹Œ?

[í¬ë¡¬ ê°œë°œìì˜ ë‹µë³€](https://groups.google.com/a/chromium.org/g/headless-dev/c/DqaAEXyzvR0/m/P9zmTLMvDQAJ)ì—ì„œ ì˜¤í”ˆí•œ ì½”ë“œë¡œ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

![Answer](/img/posts/6/answer.png)

omg... ì½”ë“œë¥¼ ë³´ë ¤ë‹ˆ 2017ë…„ì˜ ë‹µë³€ì´ê³  í˜„ì¬ 7ë…„ì´ ì§€ë‚œë§Œí¼ ì½”ë“œë„ ë°”ë€ ëª¨ì–‘ì´ë‹¤. (+ ì—ëŸ¬ ë©”ì‹œì§€)

![Error](/img/posts/6/error.png)

ë‹¤í–‰íˆ ë””ë ‰í† ë¦¬ëŠ” ë¦¬íŒ©í† ë§í•˜ì§€ ì•Šì€ ëª¨ì–‘ì´ë‹¤. [resource_pool.cc](https://source.chromium.org/chromium/chromium/src/+/main:cc/resources/resource_pool.cc;l=90-94) íŒŒì¼ì—ì„œ í•´ë‹¹ ì •ë³´ì— ëŒ€í•œ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.

![getArea](/img/posts/6/getArea.png)

ì£¼ì„ì„ ë³´ë‹ˆ `GetArea` í•¨ìˆ˜ëŠ” overflow (ë·°í¬íŠ¸ê°€ ì˜¤ë²„í”Œë¡œìš° í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ ì¶”ì •ëœë‹¤) ëœë‹¤ë©´ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ”ë°, `max_texture_size()` ë¼ëŠ” í•¨ìˆ˜ë¡œ ì´ë¥¼ ì œí•œí•´ì„œ overflowê°€ ë˜ì§€ ì•Šë‚˜ë³´ë‹¤.

ê·¸ëŸ¬ë©´ ì´ì œ `max_texture_size` ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì•„ë³´ì!

ì•„ì‰½ê²Œë„ ë‚˜ëŠ” C++ê³¼ OpenGLì— ëŒ€í•œ ì§€ì‹ì´ ì œë¡œì—¬ì„œ GPTì˜ ë„ì›€ì„ ë°›ì•„ì„œ ì°¾ì•„ë³´ì•˜ë‹¤.

![GPT1](/img/posts/6/gpt1.png)

[`max_texture_size`](https://source.chromium.org/chromium/chromium/src/+/main:third_party/khronos/GLES2/gl2.h;l=183;drc=2176b043b513af28108c91e30d38d0ed1f0dd777;bpv=0;bpt=1) ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì•˜ë‹¤!
![Max Texture Size](/img/posts/6/max_texture_size.png)

`0x0D33` ì´ë¼ëŠ” ê°’ì„ ê°€ì§€ê³  ìˆëŠ”ë°â€¦ ì´ê±´ ì‚¬ì‹¤ ì‹­ì§„ìˆ˜ë¡œ 3379ì´ë‹¤.
ì‹¤ì œë¡œ ê³„ì‚°í•˜ëŠ” ê°’ì´ë¼ê¸° ë³´ë‹¤ ë¬´ì–¸ê°€ì˜ Key ì¸ ê²ƒ ê°™ë‹¤.

`GL_MAX_TEXTURE_SIZE` ë¼ëŠ” ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì„ [ì°¾ì•˜ë‹¤!](https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/graphics/gpu/drawing_buffer.cc;l=909;drc=2176b043b513af28108c91e30d38d0ed1f0dd777;bpv=1;bpt=1)
![GetIntegerv](/img/posts/6/GetIntegerv.png)

`GetIntegerv` ë¼ëŠ” ë¬´ì–¸ê°€ë¥¼ ì‚¬ìš©í•˜ë‚˜ë³´ë‹¤.
[`GetIntegerv`](https://source.chromium.org/chromium/chromium/src/+/main:gpu/command_buffer/common/gles2_cmd_format_autogen.h;l=4696-4732;drc=2176b043b513af28108c91e30d38d0ed1f0dd777?q=GetIntegerv&ss=chromium%2Fchromium%2Fsrc) ë¥¼ ì°¾ì•˜ë‹¤!

Chromium Code Searchë¥¼ ì‚¬ìš©í•´ë³´ë©´ì„œ ëŠë‚€ê±´ë°, ì½”ë“œ í…ìŠ¤íŠ¸ ì—ë””í„°ë¥¼ ì°¸ ì˜ë§Œë“¤ì—ˆë‹¤.

ì‚¬ì‹¤ìƒ ì›¹ìœ¼ë¡œ IDEë¥¼ ì“°ëŠ” ê²ƒì²˜ëŸ¼ ê²€ìƒ‰í•˜ê¸°ê°€ í¸í•˜ë‹¤

ê²€ìƒ‰í•œ ë³€ìˆ˜ê°€ êµ¬ì¡°ì²´ì¸ì§€, í´ë˜ìŠ¤ì¸ì§€, í•¨ìˆ˜ì¸ì§€ ì˜ì•Œë ¤ì¤€ë‹¤.

ì•„ë¬´íŠ¼ ì½”ë“œë¥¼ ì´í•´í•  ìˆ˜ê°€ ì—†ì–´ì„œ GPTí•œí…Œ ì½”ë“œ ë‚´ìš©ì„ ë¬¼ì–´ë´¤ë‹¤.

![GPT2](/img/posts/6/gpt2.png)

ì •ë¦¬í•˜ìë©´, `GetIntegerv` ë¥¼ í˜¸ì¶œí•  ë•Œ, GPUê°€ ê°’ì„ ì¡°íšŒí•˜ê³  ê³µìœ  ë©”ëª¨ë¦¬ì— ê²°ê³¼ê°’ì„ ì˜¬ë¦°ë‹¤. (ë¦¬í„´í•˜ì§€ ì•ŠëŠ”ë‹¤ë¼ê³  í•œë‹¤.)

ì•„ë˜ì™€ ê°™ì€ ì½”ë“œëŠ” ê·¸ë˜ì„œ `0x0D33` ìœ¼ë¡œ ê°’ì„ ì¡°íšŒí•˜ê³ , `&max_texture_size_` ë¼ëŠ” ê³µìœ  ë©”ëª¨ë¦¬ ì£¼ì†Œì— ê²°ê³¼ê°’ì„ ì €ì¥í•œë‹¤.

```
gl_->GetIntegerv(GL_MAX_TEXTURE_SIZE, &max_texture_size_);
```

ê·¸ë¦¬ê³  `&max_texture_size_` ì£¼ì†Œë¥¼ ì¡°íšŒí•´ì„œ ê²°ê³¼ê°’ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³´ì¸ë‹¤.

ì´ í›„ëŠ” **í•˜ë“œì›¨ì–´ (ì •í™•íˆëŠ” GPU) ì— ì˜ì¡´í•˜ì—¬ ê²°ê³¼ê°’ì´ ìƒì„±**ë¼ì„œ ì •í™•í•œ ê°’ì„ ì¶”ì í•˜ê¸° ì–´ë µë‹¤.

ì´ë¡œì„œ Eric Secklerì˜ ì•„ë˜ ë‹µë³€ì€ íƒ€ë‹¹í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

> **For the software GL backend we use with headless, this limit is 16384px.**

## ë¬¸ì œë¥¼ í•´ê²°í•˜ì

- **ë·°í¬íŠ¸ë¥¼ ì˜®ê²¨ì„œ ì—¬ëŸ¬ ì´ë¯¸ì§€ ìŠ¤í¬ë¦°ìƒ·**

1.  `puppeteer`ë¡œ ë·°í¬íŠ¸ë¥¼ ì˜®ê¸´ë‹¤. ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ë²•ì€ [`window.scrollTo()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo)
2.  ë·°í¬íŠ¸ê°€ overflow ë  ë•Œê¹Œì§€ ìŠ¤í¬ë¦°ìƒ·í•œë‹¤.
3.  ì—¬ëŸ¬ ê°œì˜ ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€ ê°’ `Uint8Array` ì„ ë°°ì—´ì— ë‹´ëŠ”ë‹¤.

- **ìœ„ ì´ë¯¸ì§€ë“¤ì„ stitch**

1.  `sharp`ë¡œ ìœ„ ì´ë¯¸ì§€ë“¤ì„ í•©ì¹œë‹¤.
2.  ì´ë¯¸ì§€ í‹€ì„ ìƒì„±í•œë‹¤.

```typescript
// ì˜ˆì‹œ ì½”ë“œ
const baseImage = await sharp({
  create: {
    width: 1000,
    height: 20000,
  },
})
  .png()
  .toBuffer();
```

3. ì´ë¯¸ì§€ í‹€ì— ì´ë¯¸ì§€ ë°°ì—´ì— ìˆëŠ” ì´ë¯¸ì§€ë“¤ì„ í•©ì„±í•œë‹¤.

```typescript
// ì˜ˆì‹œ ì½”ë“œ
const composites = [];

for (let i = 0; i < screenshots.length; i++) {
  const imgBuffer = screenshots[i];
  // í˜„ì¬ ìŠ¤í¬ë¦°ìƒ·ì˜ ë©”íƒ€ë°ì´í„°(ë„ˆë¹„, ë†’ì´ ë“±)ë¥¼ ì–»ì–´ì˜´
  const meta = await sharp(imgBuffer).metadata();
  // ê° ìŠ¤í¬ë¦°ìƒ·ì˜ y ì¢Œí‘œ (ìŠ¤í¬ë¡¤í•œ ìœ„ì¹˜)
  let top = i * viewportHeight;

  // ë§Œì•½ ìŠ¤í¬ë¦°ìƒ·ì´ ì´ë¯¸ì§€ í‹€ì„ ë²—ì–´ë‚œë‹¤ë©´ í¬ë¡­
  if (top + meta.height > totalHeight) {
    const cropHeight = totalHeight - top; // base image ì•ˆì— ë“¤ì–´ê°ˆ ë†’ì´
    const croppedBuffer = await sharp(imgBuffer)
      .extract({ left: 0, top: 0, width: meta.width, height: cropHeight })
      .toBuffer();

    composites.push({
      input: croppedBuffer,
      top: top,
      left: 0,
    });
  } else {
    // ê·¸ëŒ€ë¡œ í•©ì„±
    composites.push({
      input: imgBuffer,
      top: top,
      left: 0,
    });
  }
}
```

**ì£¼ì˜í•  ì : í•©ì„±í•œ ì´ë¯¸ì§€ê°€ ì´ë¯¸ì§€ í‹€ì˜ ì‚¬ì´ì¦ˆë³´ë‹¤ í¬ë©´ ë‹¤ìŒ ì—ëŸ¬ê°€ ë‚œë‹¤.**

```
[Error: Input image exceeds pixel limit]
```

## ê²°ê³¼

- ìˆ˜ì • ì „
- ìˆ˜ì • í›„
