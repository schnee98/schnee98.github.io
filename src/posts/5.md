---
title: "래퍼처럼 플로우를 타지 않는 방법"
date: "2024-08-25"
description: "우리는 래퍼가 아닌 개발자다!"
thumbnail: "img/posts/4/storybook_fail1.png"
---


8월 초부터 **토스**에서 프론트엔드 개발 어시스턴트로 일할 기회를 얻게 되었습니다! 🎉

새로운 직장에서의 경험은 매우 흥미로웠고, 모든 부분에서 많이 배우고 있습니다.

이번 포스트에서는 제가 실제로 겪었던 DOM 노드 최적화 사례와 그 과정에서 배운 점들을 공유하고자 합니다.

# 브라우저를 느리게 만드는 이유: 리플로우, 리페인트, 리렌더링

우리가 개발하는 웹 페이지가 느려지는 이유는 다양하지만, 그 중에서도 리플로우(Reflow)와 리페인트(Repaint)는 중요한 역할을 합니다.

이 두 가지는 브라우저가 화면을 렌더링할 때 발생하는 주요 과정으로, 최적화되지 않으면 성능 저하를 유발할 수 있습니다.

## 리플로우
리플로우는 DOM의 구조나 스타일이 변경되어 레이아웃을 다시 계산해야 할 때 발생합니다.

예를 들어, 새로운 요소가 추가되거나 기존 요소의 크기, 위치 등이 변경되면 브라우저는 해당 변화를 반영하기 위해 전체 또는 일부 레이아웃을 다시 계산해야 합니다. 이 과정이 잦아지면 페이지가 느려질 수 있습니다.

리플로우를 발생시키는 원인
- DOM 요소의 위치, 크기 변경
- 콘텐츠의 동적 추가/삭제
- 브라우저 창 크기 조절 등

## 리페인트
리페인트는 요소의 시각적 속성(색상, 테두리 등)이 변경될 때 발생합니다.

리플로우가 레이아웃을 재계산하는 것이라면, 리페인트는 계산된 레이아웃을 화면에 다시 그리는 과정입니다. 

리페인트는 리플로우에 비해 비용이 적지만, 빈번히 발생하면 여전히 성능에 부정적인 영향을 미칠 수 있습니다.

리페인트를 발생시키는 원인
- 요소의 배경색, 글자색 변경
- 보더 스타일 변경 등

## 리렌더링
리렌더링은 전체 UI를 다시 그리는 과정을 의미합니다.

리플로우나 리페인트보다 더 큰 범위의 작업이 수행되며, 성능에 상당한 영향을 줄 수 있습니다.

특히 리액트와 같은 라이브러리/프레임워크에서는 상태 변화에 따른 리렌더링이 빈번하게 발생할 수 있어, 이를 최소화하는 것이 중요합니다.

리렌더링을 발생시키는 원인
- 상태(state)나 props의 변경
- 부모 컴포넌트의 리렌더링 등

## DOM 노드 최적화 방법
성능 최적화를 위해서는 리플로우와 리페인트, 리렌더링을 최소화하는 것이 중요합니다. 이를 위해 몇 가지 방법을 활용할 수 있습니다.

- GPU 활용: keyframes, transition, transform
    - CSS에서 keyframes, transition, transform 속성을 사용하면 GPU를 활용한 렌더링이 가능해집니다. 이는 CPU보다 더 빠른 렌더링을 가능하게 하며, 리플로우와 리페인트의 빈도를 줄이는 데 도움이 됩니다.

기타 DOM 노드 최적화 방법
- CSS로 가능한 많은 스타일링을 처리해 JavaScript의 사용을 줄입니다.
- 불필요한 DOM 조작을 피하고, 변화가 필요한 부분만 최소화하여 업데이트합니다.
- 리액트에서는 useMemo, useCallback, React.memo 등을 활용해 불필요한 리렌더링을 방지할 수 있습니다.

## 실제 사례: 코드 리뷰
제가 실제로 경험한 코드 리뷰 사례를 통해 최적화의 중요성을 다시 한번 느낄 수 있었습니다.

- 리뷰 전 코드 (최악의 사례): 처음 작성한 코드에서는 ref를 사용해 직접 DOM 요소의 스타일을 변경했습니다. 이는 리플로우를 자주 발생시켜 성능에 큰 영향을 미쳤습니다.
- 리뷰로 제안된 코드 (개선된 사례): 리뷰를 통해 state를 사용해 동적으로 스타일링하는 방법을 제안받았습니다. 이 방법은 리렌더링이 필요할 때만 스타일이 변경되도록 하여 성능을 일부 개선할 수 있었습니다.
- 최종 반영된 코드 (최적의 사례): 최종적으로는 CSS만으로 스타일 변경을 처리하는 방법을 사용했습니다. 이를 통해 리플로우와 리렌더링을 모두 최소화하며, 가장 효율적인 성능을 달성할 수 있었습니다.

## 얼마나 느려질까?
리플로우, 리페인트, 리렌더링이 성능에 미치는 영향을 확인하기 위해 성능 측정을 해본 결과, 최적화 전후의 차이는 상당했습니다.
예를 들어, 최적화 전에는 특정 작업에서 수백 밀리초가 소요되었지만, 최적화 후에는 그 시간이 절반 이하로 줄어들었습니다.
이는 사용자 경험을 크게 향상시키는 중요한 요소임을 알 수 있습니다.

## 느낀 점
이번 경험을 통해 최적화의 중요성을 다시 한번 깨달았습니다. 특히 프론트엔드 개발에서는 성능을 고려한 코딩이 필수적입니다.

기능 구현에만 집중하기보다는, 그 기능이 불필요한 리렌더링을 발생시키지 않도록 주의해야 합니다. 또한, 최적화 작업이 오버 엔지니어링이 되지 않도록 항상 균형을 유지하는 것이 중요합니다.

